name: Selenide Tests CI

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout del repositorio
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ Setup Java 17 (con Maven)
      - name: Setup Java 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'
          cache: maven

      # 3️⃣ Instalar Google Chrome
      - name: Install Google Chrome
        uses: browser-actions/setup-chrome@v1

      # 4️⃣ Ejecutar los tests en modo headless
      - name: Run Selenide Tests (Headless)
        env:
          # Fuerza el modo headless
          SELENIDE_HEADLESS: true
          # Opción alternativa si el proyecto usa system properties
          MAVEN_OPTS: "-Dselenide.headless=true -Dselenide.browser=chrome"
        run: |
          echo "Running Selenide tests in headless mode..."
          mvn clean test -B -e

      # 5️⃣ Generar reporte Allure (aunque falle la build)
      - name: Generate Allure Report
        if: always()
        run: |
          echo "Generating Allure report..."
          mvn allure:report || echo "Allure report generation failed but continuing."

      # 6️⃣ Subir el reporte como artefacto
      - name: Upload Allure Report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: allure-report
          path: target/site/allure-maven-plugin

